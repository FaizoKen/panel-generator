import{Q as F,R as Y,U as G,V as k,y as A,d as D,I as w,j as e,W as V,X as T,Y as P,Z as W,k as X,$ as O,v as $,E as C,b as _,r as f,m as E,a0 as Z,a1 as z,a2 as B,T as S,a3 as H,a4 as J,w as K,a5 as I,a6 as ee,t as te,g as se,a7 as ne,a8 as ae,f as U,L as oe}from"./main-ad831e85.js";import{S as ie}from"./index-739a6429.js";import{a as ce}from"./PremiumSuggest-e65641fb.js";import{p as R}from"./index-e4f144c6.js";const L=i=>F()(Y(G((n,m)=>({actions:{},clear:()=>n({actions:{}}),setActionSet:(l,s)=>n(t=>{t.actions[l]=s}),addAction:(l,s)=>n(t=>{const a=t.actions[l];a?a.actions.push(s):t.actions[l]={actions:[s]}}),clearActions:l=>n(s=>{const t=s.actions[l];t&&(t.actions=[])}),deleteAction:(l,s)=>n(t=>{const a=t.actions[l];a&&a.actions.splice(s,1)}),moveActionUp:(l,s)=>n(t=>{const a=t.actions[l];if(a){const r=a.actions[s];r&&(a.actions.splice(s,1),a.actions.splice(s-1,0,r))}}),moveActionDown:(l,s)=>{n(t=>{const a=t.actions[l];if(a){const r=a.actions[s];r&&(a.actions.splice(s,1),a.actions.splice(s+1,0,r))}})},duplicateAction:(l,s)=>{n(t=>{const a=t.actions[l];if(a){const r=a.actions[s];r&&a.actions.splice(s+1,0,{...r,id:k()})}})},setActionType:(l,s,t)=>n(a=>{const r=a.actions[l],o=r.actions[s];t===1||t===6||t===8?r.actions[s]={type:t,id:o.id,text:"",public:!1}:t===5||t===7||t===9?r.actions[s]={type:t,id:o.id,target_id:"",public:!1}:t===2||t===3||t===4?r.actions[s]={type:t,id:o.id,target_id:"",public:!1,disable_default_response:!1}:t===10&&(r.actions[s]={type:t,id:o.id,permissions:"0",role_ids:[],disable_default_response:!1})}),setActionText:(l,s,t)=>n(a=>{const o=a.actions[l].actions[s];(o.type===1||o.type===6||o.type===8||o.type===10&&o.disable_default_response)&&(o.text=t)}),setActionTargetId:(l,s,t)=>n(a=>{const o=a.actions[l].actions[s];(o.type===2||o.type===3||o.type===4||o.type===5||o.type===7||o.type===9)&&(o.target_id=t)}),setActionPublic:(l,s,t)=>n(a=>{const o=a.actions[l].actions[s];o.type!==10&&(o.public=t)}),setActionDisableDefaultResponse:(l,s,t)=>n(a=>{const o=a.actions[l].actions[s];(o.type===2||o.type===3||o.type===4||o.type===10)&&(o.disable_default_response=t)}),setActionPermissions:(l,s,t)=>n(a=>{const o=a.actions[l].actions[s];o.type===10&&(o.permissions=t)}),setActionRoleIds:(l,s,t)=>n(a=>{const o=a.actions[l].actions[s];o.type===10&&(o.role_ids=t)})}),{name:i,version:0})));L("current-message-actions");const v=L("custom-commands-actions");function le({cmdId:i,actionIndex:n}){const m=A(),l=(m==null?void 0:m.max_actions_per_component)||0,s=D(c=>c.guildId),t=v(c=>{var g;return(g=c.actions[i])==null?void 0:g.actions[n]},w),a=v(c=>{var g,M;return((M=(g=c.actions[i])==null?void 0:g.actions)==null?void 0:M.length)||0}),[r,o,p,b]=v(c=>[c.moveActionUp,c.moveActionDown,c.duplicateAction,c.deleteAction],w),[h,j,d,x,y,u,N]=v(c=>[c.setActionType,c.setActionText,c.setActionTargetId,c.setActionPublic,c.setActionDisableDefaultResponse,c.setActionRoleIds,c.setActionPermissions],w);return e.jsx(V,{guildId:s,actionCount:a,maxActions:l,actionIndex:n,action:t,collapsableId:`actions.${i}.actions.${t.id}`,moveUp:()=>r(i,n),moveDown:()=>o(i,n),duplicate:()=>p(i,n),remove:()=>b(i,n),setText:c=>j(i,n,c),setType:c=>h(i,n,c),setTargetId:c=>d(i,n,c),setPublic:c=>x(i,n,c),setDisableDefaultResponse:c=>y(i,n,c),setRoleIds:c=>u(i,n,c),setPermissions:c=>N(i,n,c)})}function Q({cmdId:i}){const n=A(),m=(n==null?void 0:n.max_actions_per_component)||0,l=v(r=>{var o;return((o=r.actions[i])==null?void 0:o.actions.map(p=>p.id))||[]},w),[s,t]=v(r=>[r.addAction,r.clearActions],w);function a(){s(i,{id:k(),type:1,text:"",public:!1})}return e.jsxs(T,{id:`actions.${i}`,valiationPathPrefix:`actions.${i}`,title:"Actions",extra:e.jsxs("div",{className:"text-sm italic font-light text-gray-400",children:[l.length," / ",m]}),children:[e.jsx(P,{className:"space-y-2",children:l.map((r,o)=>e.jsx(le,{cmdId:i,actionIndex:o},r))}),e.jsxs("div",{className:"space-x-3 mt-3 text-sm",children:[l.length<m?e.jsx("button",{className:"bg-blurple px-3 py-2 rounded transition-colors hover:bg-blurple-dark text-white",onClick:a,children:"Add Action"}):e.jsx("button",{disabled:!0,className:"bg-dark-2 px-3 py-2 rounded transition-colors cursor-not-allowed text-gray-300",children:"Add Action"}),e.jsx("button",{className:"px-3 py-2 rounded border-2 border-red hover:bg-red transition-colors text-white",onClick:()=>t(i),children:"Clear Actions"})]})]})}function re({cmdId:i,parameters:n,parameterIndex:m,maxParameters:l,setParameters:s}){const t=n[m];function a(){const d=[...n];d.splice(m-1,0,d.splice(m,1)[0]),s(d)}function r(){const d=[...n];d.splice(m+1,0,d.splice(m,1)[0]),s(d)}function o(){const d=[...n];d.splice(m,0,{...t,id:k()}),s(d)}function p(){const d=[...n];d.splice(m,1),s(d)}function b(d){const x=[...n];x[m].type=parseInt(d),s(x)}function h(d){const x=[...n];x[m].name=d,s(x)}function j(d){const x=[...n];x[m].description=d,s(x)}return e.jsx("div",{className:"p-3 border-2 border-dark-6 rounded-md",children:e.jsx(T,{id:`command.${i}.parameters.${t.id}`,title:`Argument ${m+1}`,buttons:e.jsxs("div",{className:"flex-none text-gray-300 flex items-center space-x-2",children:[m>0&&e.jsx(W,{className:"h-6 w-6 flex-none",role:"button",onClick:a}),m<n.length-1&&e.jsx(X,{className:"h-6 w-6 flex-none",role:"button",onClick:r}),n.length<l&&e.jsx(O,{className:"h-5 w-5 flex-none",role:"button",onClick:o}),e.jsx($,{className:"h-5 w-5 flex-none",role:"button",onClick:p})]}),extra:t.name?e.jsxs("div",{className:"text-gray-500 truncate flex space-x-2 pl-2",children:[e.jsx("div",{children:"-"}),e.jsx("div",{className:"truncate",children:t.name})]}):null,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col space-y-3 lg:flex-row lg:space-x-3 lg:space-y-0",children:e.jsxs("div",{className:"flex-none",children:[e.jsx("div",{className:"mb-1.5 flex",children:e.jsx("div",{className:"uppercase text-gray-300 text-sm font-medium",children:"Type"})}),e.jsxs("select",{className:"bg-dark-2 rounded p-2 w-full no-ring font-light cursor-pointer text-white",value:t.type.toString(),onChange:d=>b(d.target.value),children:[e.jsx("option",{value:"3",children:"Text"}),e.jsx("option",{value:"4",children:"Whole Number"}),e.jsx("option",{value:"10",children:"Decimal Number"}),e.jsx("option",{value:"5",children:"True / False"}),e.jsx("option",{value:"6",children:"User"}),e.jsx("option",{value:"7",children:"Channel"}),e.jsx("option",{value:"8",children:"Role"}),e.jsx("option",{value:"11",children:"File"})]})]})}),e.jsx(C,{label:"Name",type:"text",maxLength:32,value:t.name,onChange:h}),e.jsx(C,{label:"Description",type:"text",maxLength:100,value:t.description,onChange:j})]})})})}function q({cmdId:i,parameters:n,setParameters:m}){function s(){m([...n,{id:k(),name:"",description:"",type:3}])}return e.jsxs(T,{id:`command.${i}.parameters`,valiationPathPrefix:`actions.${i}`,title:"Arguments",extra:e.jsxs("div",{className:"text-sm italic font-light text-gray-400",children:[n.length," / ",5]}),children:[e.jsx(P,{className:"space-y-2",children:n.map((t,a)=>e.jsx(re,{cmdId:i,parameterIndex:a,parameters:n,setParameters:m,maxParameters:5,parameterCount:n.length},t.id))}),e.jsxs("div",{className:"space-x-3 mt-3 text-sm",children:[n.length<5?e.jsx("button",{className:"bg-blurple px-3 py-2 rounded transition-colors hover:bg-blurple-dark text-white",onClick:s,children:"Add Parameter"}):e.jsx("button",{disabled:!0,className:"bg-dark-2 px-3 py-2 rounded transition-colors cursor-not-allowed text-gray-300",children:"Add Parameter"}),e.jsx("button",{className:"px-3 py-2 rounded border-2 border-red hover:bg-red transition-colors text-white",onClick:()=>m([]),children:"Clear Parameter"})]})]})}function de({cmd:i}){const n=D(c=>c.guildId),m=_(c=>c.create),[l,s]=f.useState(!1),[t,a]=f.useState(i.name),[r,o]=f.useState(i.description),[p,b]=f.useState(i.parameters),h=E(),j=Z();f.useEffect(()=>{const c=z.safeParse(i.actions);c.success&&v.getState().setActionSet(i.id,c.data)},[i.actions]);function d(){if(t.length==0||r.length==0)return;const c=v.getState().actions[i.id];j.mutate({guildId:n,commandId:i.id,req:{name:t,description:r,enabled:!0,parameters:p,actions:c||null}},{onSuccess(g){g.success?(s(!1),h.invalidateQueries(["custom-bot",n,"commands"])):m({title:"Failed to update command",message:g.error.message,type:"error"})}})}const x=B(),[y,u]=f.useState(!1);function N(){x.mutate({commandId:i.id,guildId:n},{onSuccess:c=>{c.success?h.invalidateQueries(["custom-bot",n,"commands"]):m({title:"Failed to delete command",message:c.error.message,type:"error"})}})}return e.jsxs("div",{children:[e.jsx(P,{className:"bg-dark-3 rounded",children:l?e.jsxs("div",{className:"px-5 py-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"flex items-center space-x-2 truncate text-lg mb-5",children:e.jsxs("div",{className:"text-white truncate",children:[e.jsx("span",{className:"font-bold text-gray-500 text-xl",children:"/"})," ",i.name]})}),e.jsxs("div",{className:"flex items-center text-white cursor-pointer bg-blurple hover:bg-blurple-dark rounded px-2 py-1",role:"button",onClick:d,children:[e.jsx(S,{text:"Save Command",children:e.jsx(H,{className:"h-5 w-5"})}),e.jsxs("div",{className:"ml-2",children:["Save ",e.jsx("span",{className:"hidden md:inline-block",children:"Changes"})]})]})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsx(C,{label:"Name",type:"text",maxLength:32,value:t,onChange:a}),e.jsx(C,{label:"Description",type:"text",maxLength:100,value:r,onChange:o}),e.jsx(q,{parameters:p||[],setParameters:b,cmdId:i.id}),e.jsx(Q,{cmdId:i.id})]})]},"1"):e.jsxs("div",{className:"flex justify-between items-start py-4 px-5",children:[e.jsxs("div",{className:"flex-auto truncate",children:[e.jsx("div",{className:"flex items-center space-x-2 truncate text-lg mb-1",children:e.jsxs("div",{className:"text-white truncate",children:[e.jsx("span",{className:"font-bold text-gray-500 text-xl",children:"/"})," ",i.name]})}),e.jsx("div",{className:"text-gray-400 text-sm font-light whitespace-normal",children:i.description})]}),e.jsxs("div",{className:"flex flex-none items-center space-x-4 md:space-x-3",children:[e.jsxs("div",{className:"flex items-center text-gray-300 hover:text-white cursor-pointer md:bg-dark-2 md:rounded md:px-2 md:py-1",role:"button",onClick:()=>u(!0),children:[e.jsx(S,{text:"Delete Command",children:e.jsx($,{className:"h-5 w-5"})}),e.jsx("div",{className:"hidden md:block ml-2",children:"Delete"})]}),e.jsxs("div",{className:"flex items-center text-gray-300 hover:text-white cursor-pointer md:bg-dark-2 md:rounded md:px-2 md:py-1",role:"button",onClick:()=>s(!0),children:[e.jsx(S,{text:"Manage Command",children:e.jsx(J,{className:"h-5 w-5"})}),e.jsx("div",{className:"hidden md:block ml-2",children:"Manage"})]})]})]},"2")}),y&&e.jsx(K,{title:"Are you sure that you want to delete the command?",subTitle:"The command will be deleted permanently and can't be restored.",onClose:()=>u(!1),onConfirm:N})]})}function me({setCreate:i,cancelable:n}){const m=D(d=>d.guildId),l=_(d=>d.create),[s,t]=f.useState(""),[a,r]=f.useState(""),[o,p]=f.useState([]),b=E(),h=I();function j(){if(s.length==0||a.length==0||!m)return;const d=v.getState().actions.new;h.mutate({guildId:m,req:{name:s,description:a,parameters:o,actions:d||null}},{onSuccess:x=>{x.success?(t(""),r(""),i(!1),b.invalidateQueries(["custom-bot",m,"commands"])):l({title:"Failed to create command",message:x.error.message,type:"error"})}})}return e.jsxs("div",{className:"bg-dark-3 p-5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 truncate text-lg mb-5 justify-between",children:[e.jsxs("div",{className:"text-white truncate",children:[e.jsx("span",{className:"font-bold text-gray-500 text-xl",children:"/"})," ",s]}),e.jsxs("div",{className:"flex flex-none items-center space-x-4 md:space-x-3",children:[n&&e.jsxs("div",{className:"flex items-center text-gray-300 hover:text-white cursor-pointer md:bg-dark-2 md:rounded md:px-2 md:py-1",role:"button",onClick:()=>i(!1),children:[e.jsx(S,{text:"Cancel",children:e.jsx(ee,{className:"h-5 w-5"})}),e.jsx("div",{className:"hidden md:block ml-2",children:"Cancel"})]}),e.jsxs("div",{className:"flex items-center text-white cursor-pointer bg-blurple hover:bg-blurple-dark rounded px-2 py-1",role:"button",onClick:j,children:[e.jsx(S,{text:"Create Custom Command",children:e.jsx(te,{className:"h-5 w-5"})}),e.jsxs("div",{className:"ml-2",children:["Create ",e.jsx("span",{className:"hidden md:inline-block",children:"Command"})]})]})]})]}),e.jsxs("div",{className:"space-y-5 mb-5",children:[e.jsx(C,{label:"Name",type:"text",maxLength:32,value:s,onChange:t}),e.jsx(C,{label:"Description",type:"text",maxLength:100,value:a,onChange:r}),e.jsx(q,{parameters:o||[],setParameters:p,cmdId:"new"}),e.jsx(Q,{cmdId:"new"})]})]})}function fe(){var x,y;const{data:i}=se(),n=_(u=>u.create),[m,l]=f.useState(!1),s=D(u=>u.guildId),t=A(),a=ne(s),r=(x=a.data)!=null&&x.success?a.data.data.length:0,o=A(s),p=(o==null?void 0:o.max_custom_commands)||0,b=ae(),h=((y=a.data)==null?void 0:y.success)&&a.data.data.some(u=>!u.deployed_at||R(u.updated_at)>R(u.deployed_at));function j(){!s||!h||b.mutate({guildId:s},{onSuccess:u=>{u.success?a.refetch():n({title:"Failed to deploy commands",message:u.error.message,type:"error"})}})}const d=f.useMemo(()=>{var N;if(!((N=a.data)!=null&&N.success))return[];const u=a.data.data;return u.sort((c,g)=>c.name.localeCompare(g.name)),u},[a.data]);return e.jsx("div",{className:"overflow-y-auto w-full",children:e.jsxs("div",{className:"flex flex-col max-w-5xl mx-auto px-4 w-full my-5 lg:my-20",children:[e.jsxs("div",{className:"mb-10",children:[e.jsxs("div",{className:"text-white font-medium mb-3 flex items-center space-x-3",children:[e.jsx(ie,{className:"h-7 w-7 text-yellow"}),e.jsx("div",{className:"text-2xl",children:"Custom Commands"}),e.jsxs("div",{className:"font-light italic text-gray-400 flex-none",children:[r," / ",p]})]}),e.jsx("div",{className:"text-gray-400 font-light text-sm",children:"You can create custom commands to add more functionality to your custom bot. You need to configure a custom bot first which is available to servers with premium in the settings."})]}),i!=null&&i.success?t!=null&&t.max_custom_commands?e.jsxs("div",{className:"space-y-5 mb-8",children:[e.jsxs(P,{className:"space-y-5 overlfow-y-auto",children:[d.map(u=>e.jsx(de,{cmd:u},u.id)),(d.length===0||m)&&e.jsx(me,{setCreate:l,cancelable:d.length!==0})]}),e.jsxs("div",{className:"flex space-x-3 justify-end",children:[e.jsx("button",{className:U("px-3 py-2 rounded text-white",h?"bg-blurple hover:bg-blurple-dark":"bg-dark-2 cursor-not-allowed"),onClick:j,children:"Deploy Commands"}),e.jsx("button",{className:U("px-3 py-2 rounded border-2 text-white",d.length<p?"border-dark-7 hover:bg-dark-6 cursor-pointer":"border-dark-6 text-gray-300 cursor-not-allowed"),onClick:()=>d.length<p&&l(!0),children:"New Command"})]})]}):e.jsx(ce,{alwaysExpanded:!0}):e.jsx(oe,{alwaysExpanded:!0})]})})}export{fe as default};
